<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Final Tercero Ciencias</title>
    
    <!-- Tailwind CSS (Estilos modernos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Iconos vectoriales) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Tipografía) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Animaciones personalizadas para suavidad */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.8s ease-out forwards;
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        
        /* Efecto de cristal (Glassmorphism) */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen selection:bg-blue-500 selection:text-white overflow-x-hidden relative">

    <!-- --- FONDO ANIMADO --- -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600/20 rounded-full blur-[120px] animate-pulse"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[120px] animate-pulse delay-1000"></div>
        <!-- Textura de ruido para acabado profesional -->
        <div class="absolute inset-0 opacity-20" style="background-image: url('https://grainy-gradients.vercel.app/noise.svg');"></div>
    </div>

    <!-- --- CONTENIDO PRINCIPAL --- -->
    <div class="relative z-10 container mx-auto px-4 py-12 flex flex-col items-center justify-center min-h-screen">
        
        <!-- Encabezado -->
        <header class="text-center mb-12 animate-fade-in-up">
            <div class="inline-flex items-center justify-center p-2 mb-4 bg-blue-500/10 rounded-full border border-blue-400/30 backdrop-blur-md">
                <span class="px-3 py-1 text-xs font-bold text-blue-300 tracking-widest uppercase">Repositorio Académico</span>
            </div>
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4 bg-gradient-to-r from-blue-200 via-white to-blue-200 bg-clip-text text-transparent drop-shadow-lg leading-tight">
                Proyecto Final <br/> Tercero Ciencias
            </h1>
            <p class="text-blue-200/70 text-lg max-w-2xl mx-auto font-light">
                Plataforma oficial de recepción de documentos. <br/>
                Asegúrate de cumplir con los lineamientos antes de enviar.
            </p>
        </header>

        <!-- Tarjeta Principal (Upload) -->
        <div class="glass-panel w-full max-w-xl rounded-3xl p-8 shadow-2xl relative overflow-hidden group transition-all duration-300 hover:shadow-blue-500/10 hover:border-white/20 animate-fade-in-up" style="animation-delay: 0.2s;">
            
            <!-- Brillo al pasar el mouse -->
            <div class="absolute inset-0 bg-gradient-to-tr from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>

            <!-- VISTA 1: Formulario de Subida -->
            <div id="upload-view" class="transition-all duration-300">
                
                <!-- Input Oculto -->
                <input type="file" id="fileInput" class="hidden" accept=".pdf">

                <!-- Zona de Arrastre -->
                <div id="drop-zone" class="relative border-2 border-dashed border-slate-600 rounded-2xl p-10 text-center cursor-pointer transition-all duration-300 flex flex-col items-center justify-center hover:border-blue-400/50 hover:bg-slate-700/30">
                    
                    <!-- Estado Inicial (Vacío) -->
                    <div id="empty-state">
                        <div class="w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mb-4 mx-auto shadow-inner transition-transform duration-300 group-hover:scale-110">
                            <i data-lucide="cloud-upload" class="w-8 h-8 text-blue-400"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-1">Arrastra tu PDF aquí</h3>
                        <p class="text-sm text-slate-400">o haz clic para explorar tus archivos</p>
                        <div class="mt-4 px-3 py-1 bg-slate-800 rounded inline-block text-xs text-slate-500 font-mono border border-slate-700">
                            Formato: .PDF
                        </div>
                    </div>

                    <!-- Estado con Archivo Seleccionado (Oculto inicialmente) -->
                    <div id="file-state" class="hidden w-full">
                        <div class="flex flex-col items-center w-full relative">
                            <i data-lucide="file-text" class="w-12 h-12 text-blue-400 mb-3"></i>
                            <p id="filename-display" class="font-medium text-lg text-white truncate max-w-[250px]">nombre_archivo.pdf</p>
                            <p id="filesize-display" class="text-sm text-slate-400 mb-4">0.00 MB</p>
                            
                            <!-- Botón "X" para quitar archivo -->
                            <button id="remove-file-btn" class="absolute top-[-20px] right-[-20px] p-2 hover:bg-slate-600 rounded-full transition-colors">
                                <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Zona de Mensajes (Errores / Advertencias) -->
                <div id="message-area" class="hidden mt-4 p-3 rounded-lg flex items-start gap-3 text-sm border transition-all">
                    <i data-lucide="alert-circle" class="w-5 h-5 shrink-0 mt-0.5"></i>
                    <p id="message-text"></p>
                </div>

                <!-- Instrucciones de Nomenclatura -->
                <div class="mt-6 space-y-3">
                    <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                        <h4 class="text-sm font-semibold text-blue-300 mb-2 flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span>
                            Requisito de Nomenclatura
                        </h4>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            El archivo debe nombrarse estrictamente con tu apellido y nombre en mayúsculas.
                        </p>
                        <div class="mt-2 bg-black/30 p-2 rounded border border-dashed border-slate-600 text-center">
                            <code class="text-sm font-mono text-green-400">JORDAN_ROMAN.pdf</code>
                        </div>
                    </div>
                </div>

                <!-- Botón de Enviar -->
                <button id="upload-btn" disabled class="w-full mt-6 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all duration-300 bg-slate-700 text-slate-500 cursor-not-allowed group-enabled:hover:shadow-blue-500/25">
                    <span id="btn-text">Enviar Actividad</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden w-5 h-5 animate-spin"></i>
                </button>

                <!-- Barra de Progreso -->
                <div id="progress-container" class="hidden w-full bg-slate-700 h-1.5 mt-4 rounded-full overflow-hidden">
                    <div id="progress-bar" class="bg-blue-400 h-full transition-all duration-300 ease-out shadow-[0_0_10px_rgba(96,165,250,0.7)]" style="width: 0%"></div>
                </div>
            </div>

            <!-- VISTA 2: Éxito (Oculta inicialmente) -->
            <div id="success-view" class="hidden flex flex-col items-center justify-center py-10 text-center animate-fade-in">
                <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6">
                    <i data-lucide="check-circle" class="w-10 h-10 text-green-400"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">¡Envío Completado!</h3>
                <p class="text-slate-300 mb-6 max-w-xs mx-auto">Tu documento ha sido almacenado exitosamente en Google Drive.</p>
                
                <div class="flex flex-col gap-3 w-full max-w-xs">
                    <!-- Enlace directo a la carpeta de Drive -->
                    <a href="https://drive.google.com/drive/folders/1rYWnyOEcwmUy0cKspr4uDxFXQ3ljbqLH?usp=sharing" target="_blank" class="flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm font-bold transition-all hover:scale-[1.02] shadow-lg shadow-blue-500/20 text-white no-underline">
                        <i data-lucide="external-link" class="w-4 h-4"></i>
                        Ver carpeta en Drive
                    </a>
                    
                    <button id="reset-btn" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition-colors border border-white/5 text-white">
                        Subir otro archivo
                    </button>
                </div>
            </div>

        </div>
        
        <!-- Pie de página -->
        <footer class="mt-12 text-center text-slate-500 text-sm">
            <p>© 2025 Unidad Educativa - Tercero de Ciencias</p>
            <p class="text-xs mt-1 opacity-50">Sistema de almacenamiento seguro</p>
        </footer>

    </div>

    <!-- LÓGICA JAVASCRIPT -->
    <script>
        // Inicializar Iconos
        lucide.createIcons();

        // ------------------------------------------------------------------
        // CONFIGURACIÓN DEL BACKEND
        // ------------------------------------------------------------------
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwRGMmOkIYXjhMGe29fhWS1cL7VG7LmARrHgowGTOtTLWi9BsiWJT8XSVEpGOd_Xu-NDw/exec"; 
        // ------------------------------------------------------------------

        // Variables Globales
        let selectedFile = null;
        let isUploading = false;

        // Referencias al DOM (Elementos HTML)
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const emptyState = document.getElementById('empty-state');
        const fileState = document.getElementById('file-state');
        const filenameDisplay = document.getElementById('filename-display');
        const filesizeDisplay = document.getElementById('filesize-display');
        const removeFileBtn = document.getElementById('remove-file-btn');
        const messageArea = document.getElementById('message-area');
        const messageText = document.getElementById('message-text');
        const uploadBtn = document.getElementById('upload-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const uploadView = document.getElementById('upload-view');
        const successView = document.getElementById('success-view');
        const resetBtn = document.getElementById('reset-btn');

        // --- Funciones de Utilidad ---

        function validateFileName(name) {
            // Eliminar .pdf y verificar formato APELLIDO_NOMBRE (Solo mayúsculas)
            const nameWithoutExt = name.replace('.pdf', '');
            const regex = /^[A-ZÑ]+_[A-ZÑ]+$/;
            return regex.test(nameWithoutExt);
        }

        function showMessage(msg, type) {
            messageArea.classList.remove('hidden');
            messageText.innerText = msg;
            
            // Reset de clases
            messageArea.className = 'mt-4 p-3 rounded-lg flex items-start gap-3 text-sm border transition-all';
            
            if (type === 'error') {
                messageArea.classList.add('bg-red-500/10', 'border-red-500/20', 'text-red-200');
            } else if (type === 'warning') {
                messageArea.classList.add('bg-yellow-500/10', 'border-yellow-500/20', 'text-yellow-200');
            }
            lucide.createIcons();
        }

        function hideMessage() {
            messageArea.classList.add('hidden');
        }

        function handleFileSelect(file) {
            hideMessage();
            selectedFile = file;
            
            // 1. Validar que sea PDF
            if (file.type !== 'application/pdf') {
                updateUIState('invalid');
                showMessage('Error: El archivo debe ser formato PDF estrictamente.', 'error');
                return;
            }

            // 2. Validar Nombre
            if (!validateFileName(file.name)) {
                updateUIState('invalid');
                showMessage('Error Crítico: El nombre NO cumple con el formato APELLIDO_NOMBRE.pdf (Todo mayúsculas).', 'error');
                return;
            }

            // 3. Validar Tamaño (IMPORTANTE: Bajado a 4MB para seguridad en transmisión)
            // Base64 aumenta el tamaño en un ~33%. 4MB archivo ~= 5.3MB payload.
            const MAX_SIZE = 4 * 1024 * 1024; // 4MB
            if (file.size > MAX_SIZE) {
                updateUIState('invalid');
                showMessage('Error: El archivo supera los 4MB. Esto causa errores de conexión con Google.', 'error');
                return;
            }

            // Si todo está bien
            updateUIState('valid');
        }

        function updateUIState(state) {
            if (state === 'idle') {
                // Estado inicial
                selectedFile = null;
                fileInput.value = '';
                emptyState.classList.remove('hidden');
                fileState.classList.add('hidden');
                uploadBtn.disabled = true;
                uploadBtn.className = "w-full mt-6 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all duration-300 bg-slate-700 text-slate-500 cursor-not-allowed";
                hideMessage();
                dropZone.classList.remove('bg-slate-700/50', 'border-solid', 'border-blue-500/30', 'border-red-500/30');
                
            } else if (state === 'valid') {
                // Archivo correcto
                emptyState.classList.add('hidden');
                fileState.classList.remove('hidden');
                filenameDisplay.innerText = selectedFile.name;
                filesizeDisplay.innerText = (selectedFile.size / 1024 / 1024).toFixed(2) + " MB";
                
                uploadBtn.disabled = false;
                uploadBtn.className = "w-full mt-6 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all duration-300 bg-blue-600 hover:bg-blue-500 text-white hover:shadow-blue-500/25 active:scale-[0.98] cursor-pointer";
                
                dropZone.classList.add('bg-slate-700/50', 'border-solid', 'border-blue-500/30');
                dropZone.classList.remove('border-red-500/30');

            } else if (state === 'invalid') {
                // Archivo incorrecto
                emptyState.classList.add('hidden');
                fileState.classList.remove('hidden');
                filenameDisplay.innerText = selectedFile.name;
                filesizeDisplay.innerText = (selectedFile.size / 1024 / 1024).toFixed(2) + " MB";

                uploadBtn.disabled = true;
                uploadBtn.className = "w-full mt-6 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all duration-300 bg-slate-700 text-slate-500 cursor-not-allowed opacity-50";
                
                dropZone.classList.add('bg-red-500/5', 'border-solid', 'border-red-500/30');
                dropZone.classList.remove('border-blue-500/30');
            }
        }

        // --- Event Listeners (Interacciones) ---

        // Clic en zona de arrastre -> Abre selector de archivos
        dropZone.addEventListener('click', (e) => {
            if(e.target !== removeFileBtn && !removeFileBtn.contains(e.target)) {
                fileInput.click();
            }
        });

        // Efectos Drag & Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (!selectedFile) {
                dropZone.classList.add('border-blue-400', 'bg-blue-500/10', 'scale-[1.02]');
            }
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-500/10', 'scale-[1.02]');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-500/10', 'scale-[1.02]');
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                handleFileSelect(e.dataTransfer.files[0]);
            }
        });

        // Cambio en el input de archivo
        fileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                handleFileSelect(e.target.files[0]);
            }
        });

        // Botón "X" para quitar archivo
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            updateUIState('idle');
        });

        // LÓGICA DE SUBIDA (IMPORTANTE)
        uploadBtn.addEventListener('click', () => {
            if (!selectedFile) return;
            if (!validateFileName(selectedFile.name)) return;
            
            // Protección por si falta configurar el script
            if (SCRIPT_URL.includes("PEGAR_AQUI")) {
                alert("Error: Script URL no configurada.");
                return;
            }

            // Iniciar UI de carga
            isUploading = true;
            uploadBtn.disabled = true;
            btnText.innerText = "Preparando...";
            btnLoader.classList.remove('hidden');
            progressContainer.classList.remove('hidden');
            progressBar.style.width = '10%';

            // 1. Leer archivo y convertir a Base64
            const reader = new FileReader();
            reader.readAsDataURL(selectedFile);
            
            reader.onload = function(e) {
                // Extraer solo la data base64 (quitar "data:application/pdf;base64,")
                const rawLog = reader.result.split(',')[1]; 
                
                const dataSend = { 
                    data: rawLog, 
                    name: selectedFile.name, 
                    type: selectedFile.type 
                };

                btnText.innerText = "Subiendo a Drive...";
                progressBar.style.width = '100%';

                // 2. Enviar a Google Apps Script
                fetch(SCRIPT_URL, { 
                    method: "POST",
                    mode: "no-cors", // CAMBIO CRÍTICO: Modo no-cors para evitar errores de lectura de respuesta
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8",
                    },
                    body: JSON.stringify(dataSend)
                })
                .then(response => {
                    // En modo no-cors, no podemos leer el JSON, pero si la promesa se resuelve,
                    // significa que el request fue enviado exitosamente.
                    // Asumimos éxito para garantizar la transición de la UI.
                    
                    progressBar.style.width = '100%';
                    
                    setTimeout(() => {
                        uploadView.classList.add('hidden');
                        successView.classList.remove('hidden');
                        isUploading = false;
                        btnLoader.classList.add('hidden');
                        progressContainer.classList.add('hidden');
                        progressBar.style.width = '0%';
                        btnText.innerText = "Enviar Actividad";
                    }, 500);
                })
                .catch(err => {
                    console.error("Error silencioso:", err);
                    // Si ocurre un error real de red (Internet caído), reseteamos.
                    isUploading = false;
                    uploadBtn.disabled = false;
                    btnText.innerText = "Enviar Actividad"; 
                    btnLoader.classList.add('hidden');
                    progressContainer.classList.add('hidden');
                });
            };
        });

        // Botón "Subir otro archivo"
        resetBtn.addEventListener('click', () => {
            successView.classList.add('hidden');
            uploadView.classList.remove('hidden');
            updateUIState('idle');
        });

    </script>
</body>
</html>
